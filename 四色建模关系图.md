# 港口进出口流程四色建模关系图

## 1. 四色对象关系概览

```
┌─────────────────────────────────────────────────────────────────┐
│                        四色建模关系图                           │
├─────────────────────────────────────────────────────────────────┤
│  绿色事件对象 (时刻-间隔)    │  黄色角色对象 (参与者-角色)        │
│  ┌─────────────────────┐    │  ┌─────────────────────┐        │
│  │ 船舶到港事件        │    │  │ 港口调度员          │        │
│  │ 船舶靠泊事件        │    │  │ 桥吊操作员          │        │
│  │ 集装箱卸船事件      │    │  │ 堆场管理员          │        │
│  │ 集装箱装船事件      │    │  │ 海关查验员          │        │
│  │ 集装箱查验事件      │    │  │ 航运公司            │        │
│  │ 集装箱放行事件      │    │  │ 货代公司            │        │
│  │ 集装箱提货事件      │    │  └─────────────────────┘        │
│  └─────────────────────┘    │                                 │
│                             │                                 │
│  蓝色实体对象 (地点-事物)    │  粉色规格对象 (目录-规格)        │
│  ┌─────────────────────┐    │  ┌─────────────────────┐        │
│  │ 船舶                │    │  │ 船舶调度规则        │        │
│  │ 泊位                │    │  │ 集装箱作业规则      │        │
│  │ 集装箱              │    │  │ 通关规则            │        │
│  │ 堆场位置            │    │  │ 装卸作业规格        │        │
│  │ 桥吊                │    │  │ 堆场作业规格        │        │
│  │ 集卡                │    │  │ 安全作业规格        │        │
│  └─────────────────────┘    │  └─────────────────────┘        │
└─────────────────────────────────────────────────────────────────┘
```

## 2. 绿色事件对象关系链

### 2.1 进口流程事件链
```
船舶到港事件 → 船舶靠泊事件 → 集装箱卸船事件 → 集装箱查验事件 → 集装箱放行事件 → 集装箱提货事件
     ↓              ↓              ↓              ↓              ↓              ↓
  锚泊状态      靠泊状态        在堆场状态      查验中状态      放行状态        已提货状态
```

### 2.2 出口流程事件链
```
装箱申请事件 → 集装箱装箱事件 → 集装箱集港事件 → 出口申报事件 → 出口查验事件 → 出口放行事件 → 集装箱装船事件 → 船舶离港事件
     ↓              ↓              ↓              ↓              ↓              ↓              ↓              ↓
  装箱状态      已装箱状态      集港状态        申报状态        查验中状态      放行状态        装船状态        离港状态
```

### 2.3 作业事件链
```
作业开始事件 → 作业执行事件 → 作业完成事件
     ↓              ↓              ↓
  开始状态      执行中状态      完成状态
```

## 3. 黄色角色对象协作关系

### 3.1 人员角色协作
```
港口调度员 ←→ 船舶调度规则
    ↓
桥吊操作员 ←→ 装卸作业规格
    ↓
堆场管理员 ←→ 堆场作业规格
    ↓
海关查验员 ←→ 通关规则
```

### 3.2 组织角色协作
```
航运公司 ←→ 船舶调度规则
    ↓
货代公司 ←→ 通关规则
    ↓
港口调度员 ←→ 作业监控
```

### 3.3 角色权限矩阵
```
角色/权限         船舶调度  泊位分配  作业监控  集装箱装卸  设备操作  堆场管理  集装箱堆存  集装箱查验  放行确认
港口调度员         ✓        ✓        ✓        ✗          ✗        ✗        ✗          ✗          ✗
桥吊操作员         ✗        ✗        ✗        ✓          ✓        ✗        ✗          ✗          ✗
堆场管理员         ✗        ✗        ✗        ✗          ✗        ✓        ✓          ✗          ✗
海关查验员         ✗        ✗        ✗        ✗          ✗        ✗        ✗          ✓          ✓
航运公司           ✓        ✗        ✗        ✗          ✗        ✗        ✗          ✗          ✗
货代公司           ✗        ✗        ✗        ✗          ✗        ✗        ✗          ✓          ✗
```

## 4. 蓝色实体对象关系

### 4.1 船舶相关实体关系
```
船舶 ←→ 泊位
  ↓
集装箱 ←→ 堆场位置
  ↓
桥吊 ←→ 集卡
```

### 4.2 实体状态转换
```
船舶状态转换：
锚泊 → 靠泊 → 作业中 → 离港

泊位状态转换：
空闲 → 占用 → 空闲

集装箱状态转换：
在船 → 卸船中 → 在堆场 → 查验中 → 放行 → 提货中 → 已提货
在船 ← 装船中 ← 在堆场 ← 集港 ← 已装箱

设备状态转换：
空闲 → 作业中 → 空闲
```

### 4.3 实体属性关系
```
船舶属性：
- IMO号 (唯一标识)
- 船名
- 船长、船宽、吃水 (物理属性)
- 载重量 (业务属性)
- 当前状态 (状态属性)
- 当前位置 (位置属性)

泊位属性：
- 泊位编号 (唯一标识)
- 泊位长度、深度 (物理属性)
- 最大船舶长度 (业务属性)
- 当前状态 (状态属性)
- 当前船舶 (关联属性)

集装箱属性：
- 集装箱号 (唯一标识)
- 尺寸、重量 (物理属性)
- 货物类型 (业务属性)
- 当前状态 (状态属性)
- 当前位置 (位置属性)
- 所属船舶 (关联属性)
```

## 5. 粉色规格对象关系

### 5.1 业务规则关系
```
船舶调度规则 ←→ 集装箱作业规则 ←→ 通关规则
     ↓              ↓              ↓
泊位分配逻辑    重量验证逻辑    申报验证逻辑
时间窗口检查    状态转换验证    查验类型确定
优先级计算      作业依赖检查    放行条件验证
```

### 5.2 作业规格关系
```
装卸作业规格 ←→ 堆场作业规格 ←→ 安全作业规格
     ↓              ↓              ↓
卸船顺序制定    堆存位置推荐    安全条件验证
装船顺序制定    堆场布局优化    设备状态检查
设备分配逻辑    堆存效率计算    安全报告生成
```

### 5.3 规格应用关系
```
业务规则应用：
船舶调度规则 → 港口调度员 → 泊位分配
集装箱作业规则 → 桥吊操作员 → 装卸作业
通关规则 → 海关查验员 → 查验放行

作业规格应用：
装卸作业规格 → 桥吊操作员 → 作业执行
堆场作业规格 → 堆场管理员 → 堆存管理
安全作业规格 → 所有操作员 → 安全检查
```

## 6. 四色对象协作模式

### 6.1 船舶到港协作模式
```
绿色事件：船舶到港事件
    ↓
黄色角色：港口调度员
    ↓
蓝色实体：船舶 + 泊位
    ↓
粉色规格：船舶调度规则
    ↓
协作结果：泊位分配成功/失败
```

### 6.2 集装箱卸船协作模式
```
绿色事件：集装箱卸船事件
    ↓
黄色角色：桥吊操作员 + 堆场管理员
    ↓
蓝色实体：集装箱 + 桥吊 + 堆场位置
    ↓
粉色规格：集装箱作业规则 + 装卸作业规格 + 堆场作业规格
    ↓
协作结果：卸船作业成功/失败
```

### 6.3 集装箱查验协作模式
```
绿色事件：集装箱查验事件
    ↓
黄色角色：海关查验员
    ↓
蓝色实体：集装箱
    ↓
粉色规格：通关规则
    ↓
协作结果：查验通过/不通过
```

## 7. 四色建模优势

### 7.1 业务逻辑分离
- **绿色对象**：专注于业务事件的时间点和状态变化
- **黄色对象**：专注于业务参与者的角色和职责
- **蓝色对象**：专注于业务实体的属性和状态
- **粉色对象**：专注于业务规则和规格的封装

### 7.2 系统扩展性
- 新增事件类型：只需添加绿色对象
- 新增角色类型：只需添加黄色对象
- 新增实体类型：只需添加蓝色对象
- 新增业务规则：只需添加粉色对象

### 7.3 代码可维护性
- 对象职责明确，降低耦合度
- 业务规则集中管理，便于修改
- 事件驱动设计，支持异步处理
- 角色权限清晰，便于权限控制

### 7.4 测试友好性
- 每个颜色对象可以独立测试
- 业务规则可以单独验证
- 事件流程可以完整测试
- 角色协作可以模拟测试

## 8. 总结

四色建模法为港口进出口流程提供了结构化的领域模型：

1. **绿色对象**捕获业务事件，记录系统状态变化的关键时刻
2. **黄色对象**定义业务参与者，明确角色职责和权限范围
3. **蓝色对象**表示业务实体，管理物理对象的属性和状态
4. **粉色对象**封装业务规则，确保业务逻辑的一致性和可维护性

这种建模方法确保了业务逻辑的清晰分离、对象职责的明确界定、系统扩展的灵活性以及代码的可维护性和可测试性，为TOS港口操作系统提供了坚实的领域模型基础。 