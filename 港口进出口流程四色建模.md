# 港口进出口流程四色建模设计

## 1. 概述

本文档基于四色建模法对港口进出口流程进行领域建模。四色建模法包括：
- **绿色（Green）**：时刻-间隔对象，表示业务事件
- **黄色（Yellow）**：参与者-角色对象，表示业务参与者
- **蓝色（Blue）**：地点-事物对象，表示业务实体
- **粉色（Pink）**：目录-规格对象，表示业务规则和规格

## 2. 绿色对象（时刻-间隔）

### 2.1 船舶相关事件

#### 船舶到港事件
```javascript
class 船舶到港事件 {
  constructor(船舶信息, 到港时间, 锚泊位置) {
    this.事件ID = generateUUID();
    this.船舶信息 = 船舶信息;
    this.到港时间 = 到港时间;
    this.锚泊位置 = 锚泊位置;
    this.事件类型 = '船舶到港';
  }
}
```

#### 船舶靠泊事件
```javascript
class 船舶靠泊事件 {
  constructor(船舶信息, 泊位信息, 靠泊时间) {
    this.事件ID = generateUUID();
    this.船舶信息 = 船舶信息;
    this.泊位信息 = 泊位信息;
    this.靠泊时间 = 靠泊时间;
    this.事件类型 = '船舶靠泊';
  }
}
```

#### 船舶离港事件
```javascript
class 船舶离港事件 {
  constructor(船舶信息, 离港时间, 下一港口) {
    this.事件ID = generateUUID();
    this.船舶信息 = 船舶信息;
    this.离港时间 = 离港时间;
    this.下一港口 = 下一港口;
    this.事件类型 = '船舶离港';
  }
}
```

### 2.2 集装箱相关事件

#### 集装箱卸船事件
```javascript
class 集装箱卸船事件 {
  constructor(集装箱信息, 船舶信息, 卸船时间, 堆存位置) {
    this.事件ID = generateUUID();
    this.集装箱信息 = 集装箱信息;
    this.船舶信息 = 船舶信息;
    this.卸船时间 = 卸船时间;
    this.堆存位置 = 堆存位置;
    this.事件类型 = '集装箱卸船';
  }
}
```

#### 集装箱装船事件
```javascript
class 集装箱装船事件 {
  constructor(集装箱信息, 船舶信息, 装船时间, 船位) {
    this.事件ID = generateUUID();
    this.集装箱信息 = 集装箱信息;
    this.船舶信息 = 船舶信息;
    this.装船时间 = 装船时间;
    this.船位 = 船位;
    this.事件类型 = '集装箱装船';
  }
}
```

#### 集装箱提货事件
```javascript
class 集装箱提货事件 {
  constructor(集装箱信息, 提货人, 提货时间, 车辆信息) {
    this.事件ID = generateUUID();
    this.集装箱信息 = 集装箱信息;
    this.提货人 = 提货人;
    this.提货时间 = 提货时间;
    this.车辆信息 = 车辆信息;
    this.事件类型 = '集装箱提货';
  }
}
```

### 2.3 通关相关事件

#### 集装箱查验事件
```javascript
class 集装箱查验事件 {
  constructor(集装箱信息, 查验员, 查验时间, 查验结果) {
    this.事件ID = generateUUID();
    this.集装箱信息 = 集装箱信息;
    this.查验员 = 查验员;
    this.查验时间 = 查验时间;
    this.查验结果 = 查验结果;
    this.事件类型 = '集装箱查验';
  }
}
```

#### 集装箱放行事件
```javascript
class 集装箱放行事件 {
  constructor(集装箱信息, 放行时间, 放行类型) {
    this.事件ID = generateUUID();
    this.集装箱信息 = 集装箱信息;
    this.放行时间 = 放行时间;
    this.放行类型 = 放行类型; // 进口放行/出口放行
    this.事件类型 = '集装箱放行';
  }
}
```

### 2.4 作业相关事件

#### 作业开始事件
```javascript
class 作业开始事件 {
  constructor(作业计划, 开始时间, 操作员) {
    this.事件ID = generateUUID();
    this.作业计划 = 作业计划;
    this.开始时间 = 开始时间;
    this.操作员 = 操作员;
    this.事件类型 = '作业开始';
  }
}
```

#### 作业完成事件
```javascript
class 作业完成事件 {
  constructor(作业计划, 完成时间, 作业结果) {
    this.事件ID = generateUUID();
    this.作业计划 = 作业计划;
    this.完成时间 = 完成时间;
    this.作业结果 = 作业结果;
    this.事件类型 = '作业完成';
  }
}
```

## 3. 黄色对象（参与者-角色）

### 3.1 人员角色

#### 港口调度员
```javascript
class 港口调度员 {
  constructor(员工信息) {
    this.角色ID = generateUUID();
    this.员工信息 = 员工信息;
    this.角色类型 = '港口调度员';
    this.权限范围 = ['船舶调度', '泊位分配', '作业监控'];
  }
  
  分配泊位(船舶信息, 可用泊位) {
    // 泊位分配逻辑
  }
  
  监控作业进度(作业计划) {
    // 作业监控逻辑
  }
}
```

#### 桥吊操作员
```javascript
class 桥吊操作员 {
  constructor(员工信息, 设备信息) {
    this.角色ID = generateUUID();
    this.员工信息 = 员工信息;
    this.设备信息 = 设备信息;
    this.角色类型 = '桥吊操作员';
    this.权限范围 = ['集装箱装卸', '设备操作'];
  }
  
  执行装卸作业(作业指令) {
    // 装卸作业逻辑
  }
  
  报告设备状态(设备状态) {
    // 设备状态报告逻辑
  }
}
```

#### 堆场管理员
```javascript
class 堆场管理员 {
  constructor(员工信息, 负责区域) {
    this.角色ID = generateUUID();
    this.员工信息 = 员工信息;
    this.负责区域 = 负责区域;
    this.角色类型 = '堆场管理员';
    this.权限范围 = ['堆场管理', '集装箱堆存'];
  }
  
  安排堆存位置(集装箱信息) {
    // 堆存位置安排逻辑
  }
  
  优化堆场布局() {
    // 堆场优化逻辑
  }
}
```

#### 海关查验员
```javascript
class 海关查验员 {
  constructor(员工信息, 查验权限) {
    this.角色ID = generateUUID();
    this.员工信息 = 员工信息;
    this.查验权限 = 查验权限;
    this.角色类型 = '海关查验员';
    this.权限范围 = ['集装箱查验', '放行确认'];
  }
  
  执行查验(集装箱信息) {
    // 查验执行逻辑
  }
  
  确认放行(集装箱信息) {
    // 放行确认逻辑
  }
}
```

### 3.2 组织角色

#### 航运公司
```javascript
class 航运公司 {
  constructor(公司信息) {
    this.角色ID = generateUUID();
    this.公司信息 = 公司信息;
    this.角色类型 = '航运公司';
    this.权限范围 = ['船舶调度', '货物运输'];
  }
  
  提交船舶信息(船舶信息) {
    // 船舶信息提交逻辑
  }
  
  申请靠泊(船舶信息) {
    // 靠泊申请逻辑
  }
}
```

#### 货代公司
```javascript
class 货代公司 {
  constructor(公司信息) {
    this.角色ID = generateUUID();
    this.公司信息 = 公司信息;
    this.角色类型 = '货代公司';
    this.权限范围 = ['货物代理', '通关申报'];
  }
  
  提交通关申报(集装箱信息) {
    // 通关申报逻辑
  }
  
  申请提货(集装箱信息) {
    // 提货申请逻辑
  }
}
```

## 4. 蓝色对象（地点-事物）

### 4.1 船舶实体

#### 船舶
```javascript
class 船舶 {
  constructor(船舶信息) {
    this.船舶ID = generateUUID();
    this.IMO号 = 船舶信息.IMO号;
    this.船名 = 船舶信息.船名;
    this.船长 = 船舶信息.船长;
    this.船宽 = 船舶信息.船宽;
    this.吃水 = 船舶信息.吃水;
    this.载重量 = 船舶信息.载重量;
    this.当前状态 = '锚泊';
    this.当前位置 = null;
  }
  
  更新状态(新状态) {
    this.当前状态 = 新状态;
  }
  
  分配泊位(泊位信息) {
    this.当前位置 = 泊位信息;
  }
}
```

#### 泊位
```javascript
class 泊位 {
  constructor(泊位信息) {
    this.泊位ID = generateUUID();
    this.泊位编号 = 泊位信息.泊位编号;
    this.泊位长度 = 泊位信息.泊位长度;
    this.泊位深度 = 泊位信息.泊位深度;
    this.最大船舶长度 = 泊位信息.最大船舶长度;
    this.当前状态 = '空闲';
    this.当前船舶 = null;
  }
  
  分配船舶(船舶信息) {
    this.当前船舶 = 船舶信息;
    this.当前状态 = '占用';
  }
  
  释放泊位() {
    this.当前船舶 = null;
    this.当前状态 = '空闲';
  }
}
```

### 4.2 集装箱实体

#### 集装箱
```javascript
class 集装箱 {
  constructor(集装箱信息) {
    this.集装箱ID = generateUUID();
    this.集装箱号 = 集装箱信息.集装箱号;
    this.尺寸 = 集装箱信息.尺寸;
    this.重量 = 集装箱信息.重量;
    this.货物类型 = 集装箱信息.货物类型;
    this.当前状态 = '在船';
    this.当前位置 = null;
    this.所属船舶 = null;
  }
  
  更新状态(新状态) {
    this.当前状态 = 新状态;
  }
  
  更新位置(新位置) {
    this.当前位置 = 新位置;
  }
}
```

#### 堆场位置
```javascript
class 堆场位置 {
  constructor(位置信息) {
    this.位置ID = generateUUID();
    this.区域编号 = 位置信息.区域编号;
    this.行号 = 位置信息.行号;
    this.列号 = 位置信息.列号;
    this.层数 = 位置信息.层数;
    this.当前状态 = '空闲';
    this.当前集装箱 = null;
  }
  
  放置集装箱(集装箱信息) {
    this.当前集装箱 = 集装箱信息;
    this.当前状态 = '占用';
  }
  
  移除集装箱() {
    this.当前集装箱 = null;
    this.当前状态 = '空闲';
  }
}
```

### 4.3 设备实体

#### 桥吊
```javascript
class 桥吊 {
  constructor(设备信息) {
    this.设备ID = generateUUID();
    this.设备编号 = 设备信息.设备编号;
    this.设备类型 = '桥吊';
    this.承载能力 = 设备信息.承载能力;
    this.工作范围 = 设备信息.工作范围;
    this.当前状态 = '空闲';
    this.当前操作员 = null;
  }
  
  分配操作员(操作员信息) {
    this.当前操作员 = 操作员信息;
  }
  
  更新状态(新状态) {
    this.当前状态 = 新状态;
  }
}
```

#### 集卡
```javascript
class 集卡 {
  constructor(车辆信息) {
    this.车辆ID = generateUUID();
    this.车牌号 = 车辆信息.车牌号;
    this.车辆类型 = '集卡';
    this.承载能力 = 车辆信息.承载能力;
    this.当前状态 = '空闲';
    this.当前位置 = null;
    this.当前司机 = null;
  }
  
  分配司机(司机信息) {
    this.当前司机 = 司机信息;
  }
  
  更新位置(新位置) {
    this.当前位置 = 新位置;
  }
}
```

## 5. 粉色对象（目录-规格）

### 5.1 业务规则

#### 船舶调度规则
```javascript
class 船舶调度规则 {
  constructor() {
    this.规则ID = generateUUID();
    this.规则类型 = '船舶调度';
  }
  
  验证船舶泊位匹配(船舶信息, 泊位信息) {
    return 船舶信息.船长 <= 泊位信息.最大船舶长度 &&
           船舶信息.吃水 <= 泊位信息.泊位深度;
  }
  
  检查时间窗口可用性(船舶信息, 泊位信息, 时间窗口) {
    // 时间窗口检查逻辑
  }
  
  计算船舶优先级(船舶信息) {
    // 优先级计算逻辑
  }
}
```

#### 集装箱作业规则
```javascript
class 集装箱作业规则 {
  constructor() {
    this.规则ID = generateUUID();
    this.规则类型 = '集装箱作业';
  }
  
  验证重量限制(集装箱信息, 设备信息) {
    return 集装箱信息.重量 <= 设备信息.承载能力;
  }
  
  检查作业依赖(作业计划) {
    // 作业依赖检查逻辑
  }
  
  验证状态转换(当前状态, 目标状态) {
    const 有效转换 = {
      '在船': ['卸船中', '装船中'],
      '卸船中': ['在堆场'],
      '在堆场': ['查验中', '提货中', '装船中'],
      '查验中': ['在堆场', '放行'],
      '放行': ['提货中', '装船中'],
      '提货中': ['已提货'],
      '装船中': ['在船']
    };
    return 有效转换[当前状态]?.includes(目标状态) || false;
  }
}
```

#### 通关规则
```javascript
class 通关规则 {
  constructor() {
    this.规则ID = generateUUID();
    this.规则类型 = '通关';
  }
  
  验证申报完整性(申报信息) {
    // 申报完整性检查逻辑
  }
  
  确定查验类型(集装箱信息) {
    // 查验类型确定逻辑
  }
  
  验证放行条件(集装箱信息) {
    // 放行条件验证逻辑
  }
}
```

### 5.2 作业规格

#### 装卸作业规格
```javascript
class 装卸作业规格 {
  constructor() {
    this.规格ID = generateUUID();
    this.规格类型 = '装卸作业';
  }
  
  制定卸船顺序(集装箱列表) {
    // 卸船顺序制定逻辑
  }
  
  制定装船顺序(集装箱列表, 船舶信息) {
    // 装船顺序制定逻辑
  }
  
  分配作业设备(作业计划) {
    // 设备分配逻辑
  }
}
```

#### 堆场作业规格
```javascript
class 堆场作业规格 {
  constructor() {
    this.规格ID = generateUUID();
    this.规格类型 = '堆场作业';
  }
  
  推荐堆存位置(集装箱信息, 堆场状态) {
    // 堆存位置推荐逻辑
  }
  
  优化堆场布局(堆场状态) {
    // 堆场布局优化逻辑
  }
  
  计算堆存效率(堆场状态) {
    // 堆存效率计算逻辑
  }
}
```

### 5.3 安全规格

#### 安全作业规格
```javascript
class 安全作业规格 {
  constructor() {
    this.规格ID = generateUUID();
    this.规格类型 = '安全作业';
  }
  
  验证安全条件(作业环境) {
    // 安全条件验证逻辑
  }
  
  检查设备状态(设备信息) {
    // 设备状态检查逻辑
  }
  
  生成安全报告(作业记录) {
    // 安全报告生成逻辑
  }
}
```

## 6. 四色对象关系图

```
绿色事件对象：
船舶到港事件 → 船舶靠泊事件 → 集装箱卸船事件 → 集装箱查验事件 → 集装箱放行事件 → 集装箱提货事件
集装箱装箱事件 → 集装箱集港事件 → 集装箱装船事件 → 船舶离港事件

黄色角色对象：
港口调度员 ←→ 船舶调度规则
桥吊操作员 ←→ 装卸作业规格
堆场管理员 ←→ 堆场作业规格
海关查验员 ←→ 通关规则

蓝色实体对象：
船舶 ←→ 泊位
集装箱 ←→ 堆场位置
桥吊 ←→ 集卡

粉色规格对象：
船舶调度规则 ←→ 集装箱作业规则 ←→ 通关规则
装卸作业规格 ←→ 堆场作业规格 ←→ 安全作业规格
```

## 7. 四色建模实现示例

```javascript
// 四色对象协作示例
class 港口进出口流程管理器 {
  constructor() {
    this.绿色事件 = new Map();
    this.黄色角色 = new Map();
    this.蓝色实体 = new Map();
    this.粉色规格 = new Map();
  }
  
  // 处理船舶到港
  处理船舶到港(船舶信息, 到港时间) {
    // 创建绿色事件
    const 到港事件 = new 船舶到港事件(船舶信息, 到港时间);
    this.绿色事件.set(到港事件.事件ID, 到港事件);
    
    // 获取黄色角色
    const 调度员 = this.黄色角色.get('港口调度员');
    
    // 获取蓝色实体
    const 船舶 = new 船舶(船舶信息);
    this.蓝色实体.set(船舶.船舶ID, 船舶);
    
    // 应用粉色规格
    const 调度规则 = this.粉色规格.get('船舶调度规则');
    
    // 执行业务逻辑
    return 调度员.分配泊位(船舶, 调度规则);
  }
  
  // 处理集装箱卸船
  处理集装箱卸船(集装箱信息, 船舶信息) {
    // 创建绿色事件
    const 卸船事件 = new 集装箱卸船事件(集装箱信息, 船舶信息);
    this.绿色事件.set(卸船事件.事件ID, 卸船事件);
    
    // 获取黄色角色
    const 操作员 = this.黄色角色.get('桥吊操作员');
    const 管理员 = this.黄色角色.get('堆场管理员');
    
    // 获取蓝色实体
    const 集装箱 = new 集装箱(集装箱信息);
    const 桥吊 = this.蓝色实体.get('桥吊');
    
    // 应用粉色规格
    const 作业规则 = this.粉色规格.get('集装箱作业规则');
    const 作业规格 = this.粉色规格.get('装卸作业规格');
    
    // 执行业务逻辑
    if (作业规则.验证重量限制(集装箱, 桥吊)) {
      操作员.执行装卸作业(作业规格.制定卸船顺序([集装箱]));
      管理员.安排堆存位置(集装箱);
    }
  }
}
```

## 8. 总结

通过四色建模法，我们将港口进出口流程分解为四个维度的对象：

1. **绿色对象**：捕获业务事件，记录系统状态变化的关键时刻
2. **黄色对象**：定义业务参与者，包括人员和组织的角色职责
3. **蓝色对象**：表示业务实体，包括船舶、集装箱、设备等物理对象
4. **粉色对象**：封装业务规则和规格，确保业务逻辑的一致性和可维护性

这种建模方法确保了：
- 业务逻辑的清晰分离
- 对象职责的明确界定
- 系统扩展的灵活性
- 代码的可维护性和可测试性

四色建模法为TOS港口操作系统提供了结构化的领域模型，支持复杂的港口业务场景。 